"use strict";(self.webpackChunkinvictus_barber_app=self.webpackChunkinvictus_barber_app||[]).push([[792],{333:(e,t,r)=>{var a=r(848),n=r(338),i=r(540);const o=(0,r(470).UU)("https://nkkumtrkvwfasdekvguw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ra3VtdHJrdndmYXNkZWt2Z3V3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4Mjc1MjksImV4cCI6MjA2NTQwMzUyOX0.TQy3pX1cjIynRQTdqs2-GXwmBA1erQUfxQwOvLE077Q"),s=["Efectivo","Transferencia"],l=({onCalculate:e})=>{const[t,r]=(0,i.useState)(""),[n,o]=(0,i.useState)(""),[l,d]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[m,g]=(0,i.useState)(""),h=JSON.parse(localStorage.getItem("barbers")||"[]");return(0,a.jsxs)("form",{onSubmit:a=>{a.preventDefault();const i=parseFloat(n),s=parseFloat(l)||0;!t||isNaN(i)||i<=0||!c||(e({barber:.5*i+s,admin:.5*i,tip:s,total:i+s,barberName:t,payment_method:c,timestamp:new Date}),r(""),o(""),d(""),u(""),g(""))},className:"card",style:{maxWidth:500,width:"100%",margin:"0 auto",background:"var(--white)",boxSizing:"border-box"},children:[(0,a.jsx)("h2",{style:{color:"var(--black)",textAlign:"center",marginBottom:24},children:"Registrar Servicio"}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16,width:"100%"},children:[(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Barbero"}),(0,a.jsxs)("select",{value:t,onChange:e=>r(e.target.value),required:!0,className:"select",style:{width:"100%",boxSizing:"border-box"},children:[(0,a.jsx)("option",{value:"",children:"Seleccione..."}),h.map((e=>(0,a.jsx)("option",{value:e,children:e},e)))]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:16,background:"var(--light-gray)",borderRadius:8},children:[(0,a.jsx)("h3",{style:{color:"var(--black)",margin:0},children:"Servicio"}),(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Valor del servicio"}),(0,a.jsx)("input",{type:"number",value:n,onChange:e=>o(e.target.value),min:"0",step:"0.01",required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"}})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:16,background:"var(--light-gray)",borderRadius:8},children:[(0,a.jsx)("h3",{style:{color:"var(--black)",margin:0},children:"Propina"}),(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Valor de la propina"}),(0,a.jsx)("input",{type:"number",value:l,onChange:e=>d(e.target.value),min:"0",step:"0.01",className:"input",style:{width:"100%",boxSizing:"border-box"},placeholder:"Opcional"})]})]}),(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Medio de pago"}),(0,a.jsxs)("select",{value:c,onChange:e=>u(e.target.value),required:!0,className:"select",style:{width:"100%",boxSizing:"border-box"},children:[(0,a.jsx)("option",{value:"",children:"Seleccione..."}),s.map((e=>(0,a.jsx)("option",{value:e,children:e},e)))]})]}),(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Observaciones"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),className:"input",style:{width:"100%",boxSizing:"border-box"}})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",background:"var(--black)",color:"var(--gold)",borderRadius:8},children:[(0,a.jsx)("span",{style:{fontWeight:600},children:"Total:"}),(0,a.jsxs)("span",{style:{fontWeight:600},children:["$",((parseFloat(n)||0)+(parseFloat(l)||0)).toLocaleString("es-CO",{minimumFractionDigits:2})]})]}),(0,a.jsx)("button",{type:"submit",className:"btn",style:{marginTop:12,width:"100%",background:"var(--gold)",color:"var(--black)"},children:"Registrar Servicio"})]})]})};const d=({products:e,onAdd:t,onRemove:r,isAdmin:n,productList:s,onEditProductSellPrice:l,onAddProductToList:d,isAux:c})=>{const[u,m]=i.useState(""),[g,h]=i.useState(""),[p,x]=i.useState(""),[b,v]=i.useState(""),[y,f]=i.useState(""),[j,S]=i.useState(null),[w,k]=i.useState(""),[_,C]=i.useState(!1),[N,P]=i.useState(""),[A,O]=i.useState("formulario"),[z,D]=i.useState(""),[L,E]=i.useState(""),q=e=>e.toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2}),W=(s.find((e=>e.name===u.trim())),e.reduce(((e,t)=>(e[t.name]||(e[t.name]={quantity:0,buyPrice:t.buyPrice,sellPrice:t.sellPrice,lastTimestamp:t.timestamp}),e[t.name].quantity+=t.quantity,t.timestamp>e[t.name].lastTimestamp&&(e[t.name].lastTimestamp=t.timestamp),e)),{})),R=Object.keys(W).filter((e=>e.toLowerCase().includes(z.toLowerCase()))).sort(((e,t)=>e.localeCompare(t)));return(0,a.jsxs)("div",{className:"card",style:{maxWidth:700,width:"100%",margin:"2rem auto",background:"var(--white)",boxSizing:"border-box"},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:24,justifyContent:"center"},children:[(0,a.jsx)("button",{type:"button",className:"btn",style:{background:"formulario"===A?"var(--gold)":"var(--black)",color:"formulario"===A?"var(--black)":"var(--gold)"},onClick:()=>O("formulario"),children:"Formulario"}),(0,a.jsx)("button",{type:"button",className:"btn",style:{background:"inventario"===A?"var(--gold)":"var(--black)",color:"inventario"===A?"var(--black)":"var(--gold)"},onClick:()=>O("inventario"),children:"Inventario"})]}),"formulario"===A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{style:{color:"var(--black)",textAlign:"center",marginBottom:24},children:"Agregar producto o lote"}),(0,a.jsxs)("form",{onSubmit:e=>{return r=void 0,a=void 0,l=function*(){e.preventDefault();const r="__nuevo__"===u?L:u,a=Number(g),i=Number(p);if(!r.trim()||isNaN(a)||a<=0||isNaN(i)||i<0)return void f("Todos los campos son obligatorios y deben ser válidos");const l=i/a;let c=b;const y=s.find((e=>e.name===r.trim()));if(y)c=String(y.sellPrice);else{if(!b)return void f("Debe ingresar el valor de venta para un producto nuevo");d(r.trim(),Number(b)),P(`Producto "${r.trim()}" agregado correctamente al listado.`),setTimeout((()=>P("")),3e3)}t({name:r.trim(),quantity:a,buyPrice:l,sellPrice:Number(c)}),yield o.from("inventory_log").insert({action_type:"agregar",product_name:r.trim(),quantity:a,details:`Precio compra: $${q(l)}, Precio venta: $${q(Number(c))}`,user_name:n?"Luis Paez":"Auxiliar"}),m(""),E(""),h(""),x(""),v(""),f(""),C(!1)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{s(l.next(e))}catch(e){t(e)}}function o(e){try{s(l.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,o)}s((l=l.apply(r,a||[])).next())}));var r,a,i,l},style:{display:"flex",flexDirection:"column",gap:12,width:"100%",maxWidth:500,margin:"0 auto"},children:[s.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("select",{value:u,onChange:e=>m(e.target.value),required:!0,className:"select",style:{width:"100%",boxSizing:"border-box"},children:[(0,a.jsx)("option",{value:"",children:"Seleccione producto..."}),s.map((e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.name))),(0,a.jsx)("option",{value:"__nuevo__",children:"Agregar nuevo producto..."})]}),"__nuevo__"===u&&(0,a.jsx)("input",{type:"text",placeholder:"Nombre del nuevo producto",value:L,onChange:e=>E(e.target.value),required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"}})]}):(0,a.jsx)("input",{type:"text",placeholder:"Nombre del producto",value:u,onChange:e=>m(e.target.value),required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"}}),(0,a.jsx)("input",{type:"number",placeholder:"Cantidad",value:g,onChange:e=>h(e.target.value),min:"1",required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"}}),(0,a.jsx)("input",{type:"number",placeholder:"Valor venta (por unidad)",value:b,onChange:e=>v(e.target.value),min:"0",required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"}}),(0,a.jsx)("button",{type:"submit",className:"btn",style:{width:"100%"},children:"Agregar lote"})]}),y&&(0,a.jsx)("div",{style:{color:"red",marginBottom:8},children:y}),N&&(0,a.jsx)("div",{style:{color:"green",marginBottom:8},children:N})]}),"inventario"===A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{style:{color:"var(--black)",textAlign:"center",marginBottom:24},children:"Inventario de productos"}),(0,a.jsx)("div",{style:{marginBottom:16,display:"flex",justifyContent:"center"},children:(0,a.jsx)("input",{type:"text",placeholder:"Buscar producto...",value:z,onChange:e=>D(e.target.value),className:"input",style:{maxWidth:300}})}),(0,a.jsx)("div",{style:{width:"100%",overflowX:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:400},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{background:"var(--black)",color:"var(--gold)"},children:[(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"left"},children:"Producto"}),(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"center"},children:"Cantidad"}),(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"center"},children:"Valor compra"}),(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"center"},children:"Valor venta"}),(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"center"},children:"Último ingreso"}),n&&(0,a.jsx)("th",{style:{padding:8,borderRadius:8,textAlign:"center"},children:"Acción"})]})}),(0,a.jsxs)("tbody",{children:[0===R.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:n?6:5,style:{textAlign:"center",padding:16},children:"No hay productos en inventario."})}),R.map((t=>{const i=W[t];let o="var(--gold)";return o=i.quantity<=2?"#e74c3c":i.quantity<=6?"#f1c40f":"#27ae60",(0,a.jsxs)("tr",{style:{background:"var(--white)"},children:[(0,a.jsx)("td",{style:{padding:8,fontWeight:600},children:t}),(0,a.jsxs)("td",{style:{padding:8,textAlign:"center"},children:[(0,a.jsx)("span",{style:{display:"inline-block",minWidth:32,fontWeight:700,color:o},children:i.quantity}),(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,borderRadius:"50%",background:o,marginLeft:8,verticalAlign:"middle"}})]}),(0,a.jsxs)("td",{style:{padding:8,textAlign:"center"},children:["$",q(i.buyPrice)]}),(0,a.jsxs)("td",{style:{padding:8,textAlign:"center"},children:["$",q(i.sellPrice)]}),(0,a.jsx)("td",{style:{padding:8,textAlign:"center"},children:i.lastTimestamp.toLocaleString("es-CO",{timeZone:"America/Bogota"})}),n&&(0,a.jsx)("td",{style:{padding:8,textAlign:"center"},children:(0,a.jsx)("button",{onClick:()=>{const a=e.findIndex((e=>e.name===t));-1!==a&&r(a)},className:"btn btn-danger",style:{padding:"4px 10px",fontSize:13},children:"Quitar"})})]},t)}))]})]})})]})]})};var c=function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const u=(e,t,r,a,...n)=>c(void 0,[e,t,r,a,...n],void 0,(function*(e,t,r,a,n=""){yield o.from("inventory_log").insert([{action_type:e,product_name:t,quantity:r,user_name:a,details:n}])})),m=({products:e,setProducts:t,sales:r,setSales:n,isAdmin:s})=>{const[l,d]=(0,i.useState)(""),[m,g]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),x=e=>e.toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2}),b=Array.from(new Set(e.map((e=>e.name)))),v=r.reduce(((e,t)=>e+(t.sellPrice-t.buyPrice)*t.quantity),0),y=e.filter((e=>e.name.toLowerCase()===l.toLowerCase())).reduce(((e,t)=>e+t.quantity),0);return(0,a.jsxs)("div",{style:{maxWidth:500,margin:"2rem auto",fontFamily:"sans-serif",position:"relative"},children:[(0,a.jsxs)("h2",{style:{marginBottom:24},children:["Vender producto",s&&(0,a.jsxs)("span",{style:{float:"right",fontSize:16,color:"#007bff",fontWeight:"bold"},children:["Ganancia total: $",x(v)]})]}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:12},children:(0,a.jsxs)("select",{value:l,onChange:e=>d(e.target.value),style:{minWidth:180},children:[(0,a.jsx)("option",{value:"",children:"Seleccione producto..."}),b.map((e=>(0,a.jsx)("option",{value:e,children:e},e)))]})}),l&&(0,a.jsxs)("form",{onSubmit:r=>c(void 0,void 0,void 0,(function*(){r.preventDefault();const a=Number(m);if(!l)return;if(isNaN(a)||a<=0)return void p("Cantidad inválida");if(e.filter((e=>e.name.toLowerCase()===l.toLowerCase())).reduce(((e,t)=>e+t.quantity),0)<a)return void p("No hay unidades suficientes en inventario");let i=a,c=[...e],h=[];for(let e=0;e<c.length&&i>0;e++){const t=c[e];if(t.name.toLowerCase()===l.toLowerCase()&&t.quantity>0){const r=Math.min(t.quantity,i);c[e]=Object.assign(Object.assign({},t),{quantity:t.quantity-r}),h.push({name:t.name,quantity:r,buyPrice:t.buyPrice,sellPrice:t.sellPrice,total:r*t.sellPrice,payment_method:"Efectivo",timestamp:new Date}),console.log("Buscando producto en Supabase:",t.name);const{data:a,error:n}=yield o.from("products").select("id, stock").eq("name",t.name).eq("buy_price",t.buyPrice).eq("sell_price",t.sellPrice).limit(1).single();if(n||!a){console.error("Error buscando producto:",n),p("Error actualizando inventario en base de datos");continue}console.log("Producto encontrado:",a);const l=a.stock-r,{error:d}=yield o.from("products").update({stock:l}).eq("id",a.id);if(d){console.error("Error actualizando stock:",d),p("Error actualizando inventario en base de datos");continue}console.log("Registrando venta en Supabase:",{product_id:a.id,quantity:r,total:r*t.sellPrice,user_name:s?"Luis Paez":"Auxiliar"});const{error:m}=yield o.from("sales").insert([{product_id:a.id,quantity:r,total:r*t.sellPrice,user_name:s?"Luis Paez":"Auxiliar"}]);if(m){console.error("Error registrando venta:",m),p("Error registrando la venta");continue}console.log("Venta registrada correctamente"),yield u("vender",t.name,r,s?"Luis Paez":"Auxiliar",`Venta realizada - Total: $${x(r*t.sellPrice)}`),i-=r}}t(c),n((e=>[...e,...h])),p(`Venta realizada: ${a} x ${l}`),g(""),d("")})),style:{display:"flex",flexDirection:"column",gap:8,marginBottom:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:l})," | En inventario: ",y]}),(0,a.jsx)("input",{type:"number",placeholder:"Cantidad a vender",value:m,onChange:e=>g(e.target.value),min:"1",max:y,required:!0}),(0,a.jsx)("button",{type:"submit",children:"Vender"})]}),h&&(0,a.jsx)("div",{style:{color:h.startsWith("Venta realizada")?"green":"red",marginTop:8},children:h})]})};var g=r(937),h=function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const p=({onDataDeleted:e})=>{const[t,r]=(0,i.useState)("inventory"),[n,s]=(0,i.useState)([]),[l,d]=(0,i.useState)([]),[c,u]=(0,i.useState)(""),[m,p]=(0,i.useState)("");(0,i.useEffect)((()=>{x(),b()}),[]);const x=()=>h(void 0,void 0,void 0,(function*(){const{data:e,error:t}=yield o.from("inventory_log").select("*").order("created_at",{ascending:!1});t?console.error("Error cargando logs:",t):s(e||[])})),b=()=>h(void 0,void 0,void 0,(function*(){const{data:e,error:t}=yield o.from("sales").select("*, product_id (name)").order("created_at",{ascending:!1});if(t)return void console.error("Error cargando ventas:",t);const r=(null==e?void 0:e.map((e=>{var t;return{id:e.id,product_name:(null===(t=e.product_id)||void 0===t?void 0:t.name)||"",quantity:e.quantity,total:e.total,payment_method:e.payment_method,user_name:e.user_name,created_at:e.created_at}})))||[];d(r)})),v=e=>c||m?e.filter((e=>{const t=new Date(e.created_at),r=c?new Date(c):new Date(0),a=m?new Date(m):new Date;return a.setHours(23,59,59,999),t>=r&&t<=a})):e,y=v(n),f=v(l);return(0,a.jsxs)("div",{className:"historial-card",children:[(0,a.jsxs)("ul",{className:"historial-tabs",children:[(0,a.jsx)("li",{children:(0,a.jsx)("button",{className:"historial-tab"+("inventory"===t?" active":""),onClick:()=>r("inventory"),tabIndex:0,children:"Acciones de Inventario"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{className:"historial-tab"+("sales"===t?" active":""),onClick:()=>r("sales"),tabIndex:0,children:"Ventas"})})]}),(0,a.jsxs)("div",{className:"historial-actions",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Fecha Inicio"}),(0,a.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"Fecha Fin"}),(0,a.jsx)("input",{type:"date",value:m,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("button",{className:"btn-gold",onClick:()=>((e,t)=>{const r="inventory"===t?["Fecha","Acción","Producto","Cantidad","Usuario","Detalles"]:["Fecha","Producto","Cantidad","Total","Método de Pago","Usuario"],a=e.map((e=>"inventory"===t?[new Date(e.created_at).toLocaleString(),e.action_type,e.product_name,e.quantity,e.user_name,e.details]:[new Date(e.created_at).toLocaleString(),e.product_name,e.quantity,e.total,e.payment_method,e.user_name]));let n="";n+=r.join(";")+"\n",a.forEach((e=>{n+=e.map((e=>'"'+String(e).replace(/"/g,'""')+'"')).join(";")+"\n"}));const i=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.setAttribute("download",("inventory"===t?"historial_inventario":"historial_ventas")+".csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)})("inventory"===t?y:f,t),children:[(0,a.jsx)(g.WCW,{})," Descargar CSV"]}),(0,a.jsxs)("button",{className:"btn-danger",onClick:()=>h(void 0,void 0,void 0,(function*(){if(window.confirm("¿Está seguro que desea iniciar una nueva semana? Esto guardará un resumen de la semana actual y limpiará todos los registros para empezar de cero. Esta acción no se puede deshacer."))try{console.log("Iniciando nueva semana..."),console.log("Obteniendo datos de la semana actual...");const{data:t}=yield o.from("barber_services").select("*"),{data:r}=yield o.from("sales").select("*"),a={};let n=0,i=0;t&&t.forEach((e=>{const t=e.barber_name;a[t]||(a[t]=0),a[t]+=e.barber_amount,n+=e.admin_amount})),r&&(i=r.reduce(((e,t)=>e+t.total),0));const l=n+i+Object.values(a).reduce(((e,t)=>e+t),0),c=new Date,u=c.getDay(),m=0===u?6:u-1,g=new Date(c);g.setDate(c.getDate()-m);const h=new Date(g);h.setDate(g.getDate()+6),console.log("Guardando resumen de la semana...");const{error:p}=yield o.from("weekly_summaries").insert([{week_start_date:g.toISOString().split("T")[0],week_end_date:h.toISOString().split("T")[0],barber_earnings:a,product_sales_total:i,admin_earnings:n,total_earnings:l}]);if(p)throw console.error("Error guardando resumen:",p),p;console.log("Resumen de la semana guardado exitosamente"),console.log("Eliminando ventas de la semana actual...");const{error:x}=yield o.from("sales").delete().gte("id",0);if(x)throw console.error("Error eliminando ventas:",x),x;console.log("Eliminando productos del inventario actual...");const{error:b}=yield o.from("products").delete().gte("id",0);if(b)throw console.error("Error eliminando productos:",b),b;console.log("Eliminando servicios de barbería de la semana actual...");const{error:v}=yield o.from("barber_services").delete().gte("id",0);if(v)throw console.error("Error eliminando servicios:",v),v;console.log("Nueva semana iniciada exitosamente"),s([]),d([]),alert("¡Nueva semana iniciada exitosamente! El resumen de la semana anterior ha sido guardado y todos los registros han sido limpiados."),e&&e(),setTimeout((()=>{window.location.reload()}),1e3)}catch(e){console.error("Error iniciando nueva semana:",e),alert("Error al iniciar la nueva semana. Por favor, intente nuevamente.")}})),children:[(0,a.jsx)(g.qbC,{})," Iniciar Nueva Semana"]})]}),(0,a.jsx)("div",{className:"table-responsive",children:"inventory"===t?(0,a.jsxs)("table",{className:"table table-striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Fecha"}),(0,a.jsx)("th",{children:"Acción"}),(0,a.jsx)("th",{children:"Producto"}),(0,a.jsx)("th",{children:"Cantidad"}),(0,a.jsx)("th",{children:"Usuario"}),(0,a.jsx)("th",{children:"Detalles"})]})}),(0,a.jsx)("tbody",{children:y.map((e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{children:e.action_type}),(0,a.jsx)("td",{children:e.product_name}),(0,a.jsx)("td",{children:e.quantity}),(0,a.jsx)("td",{children:e.user_name}),(0,a.jsx)("td",{children:e.details})]},e.id)))})]}):(0,a.jsxs)("table",{className:"table table-striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Fecha"}),(0,a.jsx)("th",{children:"Producto"}),(0,a.jsx)("th",{children:"Cantidad"}),(0,a.jsx)("th",{children:"Total"}),(0,a.jsx)("th",{children:"Método de Pago"}),(0,a.jsx)("th",{children:"Usuario"})]})}),(0,a.jsx)("tbody",{children:f.map((e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{children:e.product_name}),(0,a.jsx)("td",{children:e.quantity}),(0,a.jsx)("td",{children:e.total.toLocaleString("es-CO",{style:"currency",currency:"COP"})}),(0,a.jsx)("td",{children:e.payment_method}),(0,a.jsx)("td",{children:e.user_name})]},e.id)))})]})})]})};const x=()=>{const[e,t]=(0,i.useState)([]),[r,n]=(0,i.useState)(!0);(0,i.useEffect)((()=>{s()}),[]);const s=()=>{return e=void 0,r=void 0,i=function*(){try{const{data:e,error:r}=yield o.from("weekly_summaries").select("*").order("week_start_date",{ascending:!1});if(r)return void console.error("Error cargando resúmenes semanales:",r);t(e||[])}catch(e){console.error("Error inesperado:",e)}finally{n(!1)}},new((a=void 0)||(a=Promise))((function(t,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var r;e.done?t(e.value):(r=e.value,r instanceof a?r:new a((function(e){e(r)}))).then(o,s)}l((i=i.apply(e,r||[])).next())}));var e,r,a,i};return r?(0,a.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:"Cargando historial semanal..."}):(0,a.jsxs)("div",{className:"historial-card",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,a.jsx)("h2",{style:{margin:0,color:"var(--black)"},children:"Historial de Resúmenes Semanales"}),(0,a.jsxs)("button",{className:"btn-gold",onClick:()=>{const t=";";let r="Semana,Barberos,Ganancia Productos,Ganancia Admin,Total\n";e.forEach((e=>{const a=`${e.week_start_date} - ${e.week_end_date}`,n=Object.values(e.barber_earnings).reduce(((e,t)=>e+t),0);r+=`${a}${t}${n}${t}${e.product_sales_total}${t}${e.admin_earnings}${t}${e.total_earnings}\n`}));const a=new Blob([r],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.setAttribute("download",`resumen_semanas_${(new Date).toISOString().slice(0,10)}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},disabled:0===e.length,children:[(0,a.jsx)(g.WCW,{})," Descargar CSV"]})]}),0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#666"},children:"No hay resúmenes semanales disponibles."}):(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Semana"}),(0,a.jsx)("th",{children:"Barberos"}),(0,a.jsx)("th",{children:"Productos"}),(0,a.jsx)("th",{children:"Admin"}),(0,a.jsx)("th",{children:"Total"})]})}),(0,a.jsx)("tbody",{children:e.map((e=>{const t=Object.values(e.barber_earnings).reduce(((e,t)=>e+t),0);return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:[(0,a.jsxs)("div",{style:{fontWeight:600},children:[new Date(e.week_start_date).toLocaleDateString("es-CO")," - ",new Date(e.week_end_date).toLocaleDateString("es-CO")]}),(0,a.jsx)("div",{style:{fontSize:"0.9rem",color:"#666"},children:Object.entries(e.barber_earnings).map((([e,t])=>(0,a.jsxs)("div",{children:[e,": $",t.toLocaleString("es-CO")]},e)))})]}),(0,a.jsxs)("td",{style:{fontWeight:600,color:"var(--gold)"},children:["$",t.toLocaleString("es-CO")]}),(0,a.jsxs)("td",{style:{fontWeight:600,color:"#27ae60"},children:["$",e.product_sales_total.toLocaleString("es-CO")]}),(0,a.jsxs)("td",{style:{fontWeight:600,color:"#e74c3c"},children:["$",e.admin_earnings.toLocaleString("es-CO")]}),(0,a.jsxs)("td",{style:{fontWeight:700,color:"var(--black)",fontSize:"1.1rem"},children:["$",e.total_earnings.toLocaleString("es-CO")]})]},e.id)}))})]})})]})};var b=function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const v=({productList:e,isAdmin:t,isAux:r})=>{const[n,s]=(0,i.useState)([]),[l,d]=(0,i.useState)(""),[c,u]=(0,i.useState)([]),[m,g]=(0,i.useState)(!1),[h,p]=(0,i.useState)(""),[x,v]=(0,i.useState)(""),[y,f]=(0,i.useState)(""),[j,S]=(0,i.useState)(""),[w,k]=(0,i.useState)(!1),[_,C]=(0,i.useState)(null);(0,i.useEffect)((()=>{N()}),[]),(0,i.useEffect)((()=>{if(!l.trim())return C(null),u([]),g(!1),p(""),void v("");const e=n.find((e=>e.client_name.toLowerCase()===l.trim().toLowerCase()&&!e.is_paid));e?(C(e.id),u(e.products),g(e.beard_service),p(e.beard_service_value?String(e.beard_service_value):""),v(e.tip?String(e.tip):"")):(C(null),u([]),g(!1),p(""),v(""))}),[l,n]);const N=()=>b(void 0,void 0,void 0,(function*(){try{const{data:e,error:t}=yield o.from("orders").select("*").eq("is_paid",!1).order("created_at",{ascending:!1});if(t)return console.error("Error fetching orders:",t),void f("Error al cargar los pedidos: "+t.message);s(e||[])}catch(e){console.error("Unexpected error fetching orders:",e),f("Error inesperado al cargar los pedidos")}})),P=(t,r,a)=>{const n=[...c];if("name"===r){const r=e.find((e=>e.name===a));r&&(n[t]=Object.assign(Object.assign({},n[t]),{name:r.name,sellPrice:r.sellPrice}))}else n[t]=Object.assign(Object.assign({},n[t]),{[r]:a});u(n)},A=()=>c.reduce(((e,t)=>e+t.sellPrice*t.quantity),0)+(m&&parseFloat(h)||0)+(parseFloat(x)||0);return(0,a.jsxs)("div",{className:"card",style:{maxWidth:800,width:"100%",margin:"2rem auto",background:"var(--white)",padding:"24px"},children:[(0,a.jsx)("h2",{style:{color:"var(--black)",textAlign:"center",marginBottom:24},children:"Nuevo Pedido"}),(0,a.jsxs)("form",{onSubmit:e=>b(void 0,void 0,void 0,(function*(){e.preventDefault(),k(!0),f("");try{if(!l.trim())return void f("Por favor ingrese el nombre del cliente");if(0===c.length&&!m)return void f("Por favor agregue al menos un producto o un servicio de barbería");if(m&&(!h||parseFloat(h)<=0))return void f("Por favor ingrese el valor del servicio de barbería");const e={client_name:l.trim(),products:c,beard_service:m,beard_service_value:m?parseFloat(h):0,tip:parseFloat(x)||0,total:A(),is_paid:!1,created_at:(new Date).toISOString()};if(_){const{error:t}=yield o.from("orders").update(e).eq("id",_);if(t)return void f("Error al actualizar el pedido: "+t.message);S("Pedido actualizado exitosamente")}else{const{data:t,error:r}=yield o.from("orders").insert([e]).select();if(r)return void f("Error al crear el pedido: "+r.message);S("Pedido creado exitosamente")}d(""),u([]),g(!1),p(""),v(""),C(null),N(),setTimeout((()=>S("")),3e3)}catch(e){f("Error inesperado al crear/actualizar el pedido")}finally{k(!1)}})),style:{display:"flex",flexDirection:"column",gap:16,width:"100%"},children:[(0,a.jsx)("div",{style:{width:"100%",boxSizing:"border-box"},children:(0,a.jsx)("input",{type:"text",placeholder:"Nombre del cliente",value:l,onChange:e=>d(e.target.value),className:"input",required:!0,disabled:w,style:{width:"100%",boxSizing:"border-box"}})}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:16,background:"var(--light-gray)",borderRadius:8},children:[(0,a.jsx)("h3",{style:{color:"var(--black)",margin:0},children:"Servicio de Barbería"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"checkbox",id:"beardService",checked:m,onChange:e=>g(e.target.checked),disabled:w}),(0,a.jsx)("label",{htmlFor:"beardService",children:"Incluir servicio de barbería"})]}),m&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Valor del servicio"}),(0,a.jsx)("input",{type:"number",value:h,onChange:e=>p(e.target.value),min:"0",step:"0.01",required:!0,className:"input",style:{width:"100%",boxSizing:"border-box"},disabled:w})]}),(0,a.jsxs)("label",{style:{width:"100%"},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:600},children:"Propina"}),(0,a.jsx)("input",{type:"number",value:x,onChange:e=>v(e.target.value),min:"0",step:"0.01",className:"input",style:{width:"100%",boxSizing:"border-box"},placeholder:"Opcional",disabled:w})]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:16,background:"var(--light-gray)",borderRadius:8},children:[(0,a.jsx)("h3",{style:{color:"var(--black)",margin:0},children:"Productos"}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:c.map(((t,r)=>(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsxs)("select",{value:t.name,onChange:e=>P(r,"name",e.target.value),className:"select",required:!0,style:{flex:2},disabled:w,children:[(0,a.jsx)("option",{value:"",children:"Seleccione un producto"}),e.map((e=>(0,a.jsxs)("option",{value:e.name,children:[e.name," - $",e.sellPrice.toLocaleString("es-CO")]},e.name)))]}),(0,a.jsx)("input",{type:"number",value:t.quantity,onChange:e=>P(r,"quantity",parseInt(e.target.value)),min:"1",className:"input",style:{width:80},required:!0,disabled:w}),(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{u(c.filter(((t,r)=>r!==e)))})(r),className:"btn btn-danger",style:{padding:"8px 12px"},disabled:w,children:"X"})]},r)))}),(0,a.jsx)("button",{type:"button",onClick:()=>{u([...c,{name:"",sellPrice:0,quantity:1}])},className:"btn",style:{alignSelf:"flex-start"},disabled:w,children:"Agregar Producto"})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",background:"var(--black)",color:"var(--gold)",borderRadius:8},children:[(0,a.jsx)("span",{style:{fontWeight:600},children:"Total:"}),(0,a.jsxs)("span",{style:{fontWeight:600},children:["$",A().toLocaleString("es-CO",{minimumFractionDigits:2})]})]}),(0,a.jsx)("button",{type:"submit",className:"btn",style:{background:"var(--gold)",color:"var(--black)"},disabled:w,children:w?_?"Actualizando...":"Creando pedido...":_?"Actualizar Pedido":"Crear Pedido"})]}),y&&(0,a.jsx)("div",{style:{color:"white",backgroundColor:"#e74c3c",padding:"12px",borderRadius:"8px",marginTop:"16px"},children:y}),j&&(0,a.jsx)("div",{style:{color:"white",backgroundColor:"#27ae60",padding:"12px",borderRadius:"8px",marginTop:"16px"},children:j}),(0,a.jsxs)("div",{style:{marginTop:32},children:[(0,a.jsx)("h3",{style:{color:"var(--black)",marginBottom:16},children:"Pedidos Pendientes"}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:0===n.length?(0,a.jsx)("div",{style:{padding:"24px",textAlign:"center",background:"var(--light-gray)",borderRadius:"8px",color:"var(--black)",fontSize:"16px"},children:"No hay pedidos pendientes en este momento"}):n.map((e=>(0,a.jsx)("div",{className:"card",style:{background:"var(--light-gray)",cursor:"pointer",transition:"all 0.2s ease",border:_===e.id?"2px solid var(--gold)":"1px solid #ddd"},onClick:()=>(e=>{d(e.client_name),C(e.id),u(e.products),g(e.beard_service),p(e.beard_service_value?String(e.beard_service_value):""),v(e.tip?String(e.tip):"")})(e),children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{style:{margin:0,color:_===e.id?"var(--gold)":"inherit"},children:[e.client_name,_===e.id&&(0,a.jsx)("span",{style:{fontSize:"12px",marginLeft:"8px",padding:"2px 6px",background:"var(--gold)",color:"var(--black)",borderRadius:"4px"},children:"Editando"})]}),e.beard_service&&(0,a.jsxs)("div",{style:{marginTop:8},children:[(0,a.jsxs)("p",{style:{margin:"4px 0"},children:["Servicio de barbería: $",e.beard_service_value.toLocaleString("es-CO")]}),e.tip>0&&(0,a.jsxs)("p",{style:{margin:"4px 0"},children:["Propina: $",e.tip.toLocaleString("es-CO")]})]}),e.products.length>0&&(0,a.jsxs)("div",{style:{marginTop:8},children:[(0,a.jsx)("p",{style:{margin:"4px 0",fontWeight:600},children:"Productos:"}),e.products.map(((e,t)=>(0,a.jsxs)("p",{style:{margin:"4px 0"},children:[e.name," x",e.quantity," - $",(e.sellPrice*e.quantity).toLocaleString("es-CO")]},t)))]})]}),(0,a.jsxs)("div",{style:{textAlign:"right"},children:[(0,a.jsxs)("div",{style:{fontSize:"1.2em",fontWeight:"bold",marginBottom:8},children:["$",e.total.toLocaleString("es-CO")]}),(0,a.jsx)("button",{onClick:t=>{var r;t.stopPropagation(),e.id&&(r=e.id,b(void 0,void 0,void 0,(function*(){try{const{error:e}=yield o.from("orders").update({is_paid:!0}).eq("id",r);if(e)return console.error("Error marking order as paid:",e),void f("Error al marcar el pedido como pagado: "+e.message);N()}catch(e){console.error("Unexpected error marking order as paid:",e),f("Error inesperado al marcar el pedido como pagado")}})))},className:"btn",style:{background:"var(--gold)",color:"var(--black)"},children:"Marcar como Pagado"})]})]})},e.id)))})]})]})},y=({results:e,role:t})=>{if("admin"!==t)return null;const r=e.reduce(((e,t)=>e+t.barber),0),n=e.reduce(((e,t)=>e+t.admin),0),i=e.reduce(((e,t)=>e+(t.tip||0)),0);return(0,a.jsxs)("div",{style:{display:"flex",gap:16,flexWrap:"wrap",justifyContent:"center"},children:[(0,a.jsxs)("div",{style:{background:"var(--white)",padding:"1.5rem 1.2rem",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.06)",minWidth:200},children:[(0,a.jsx)("h3",{style:{marginBottom:16,textAlign:"center"},children:"Ganancias Barberos"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,textAlign:"center"},children:["$",r.toLocaleString("es-CO")]})]}),(0,a.jsxs)("div",{style:{background:"var(--white)",padding:"1.5rem 1.2rem",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.06)",minWidth:200},children:[(0,a.jsx)("h3",{style:{marginBottom:16,textAlign:"center"},children:"Ganancias Admin"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,textAlign:"center"},children:["$",n.toLocaleString("es-CO")]})]}),(0,a.jsxs)("div",{style:{background:"var(--white)",padding:"1.5rem 1.2rem",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.06)",minWidth:200},children:[(0,a.jsx)("h3",{style:{marginBottom:16,textAlign:"center"},children:"Total Propinas"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,textAlign:"center"},children:["$",i.toLocaleString("es-CO")]})]})]})};var f=function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const j=[{user:"luis.paez",pass:"1234",role:"admin",name:"Luis Paez"},{user:"nataly.gomez",pass:"1002158638",role:"aux",name:"Nataly Gómez"},{user:"jose.torres",pass:"1044215117",role:"barber",name:"Jose Torres"},{user:"breiner.ferrer",pass:"1002185092",role:"barber",name:"Breiner Ferrer"},{user:"edinson.vergara",pass:"1001914098",role:"barber",name:"Edinson Vergara"},{user:"deivi.rivera",pass:"1129506575",role:"barber",name:"Deivi Rivera"}],S=j.filter((e=>"barber"===e.role)).map((e=>e.name)),w=[{key:"main",label:"Formulario y Ganancias",roles:["admin","aux"]},{key:"registros",label:"Listado de registros",roles:["admin"]},{key:"inventory",label:"Inventario",roles:["admin","aux"]},{key:"venta",label:"Vender producto",roles:["admin","aux"]},{key:"pedidos",label:"Pedidos",roles:["admin","aux"]},{key:"historial",label:"Historial",roles:["admin"]},{key:"historial_semanal",label:"Historial Semanal",roles:["admin"]},{key:"ganancias",label:"Mis Ganancias",roles:["barber"]}];var k=r(72),_=r.n(k),C=r(206),N=r.n(C),P=r(659),A=r.n(P),O=r(56),z=r.n(O),D=r(159),L=r.n(D),E=r(113),q=r.n(E),W=r(422),R={};R.styleTagTransform=q(),R.setAttributes=z(),R.insert=A().bind(null,"head"),R.domAPI=N(),R.insertStyleElement=L(),_()(W.A,R),W.A&&W.A.locals&&W.A.locals;const $=document.getElementById("root");(0,n.H)($).render((0,a.jsx)((()=>{const[e,t]=(0,i.useState)([]),[r,n]=(0,i.useState)(null),[s,c]=(0,i.useState)(null),[u,g]=(0,i.useState)(""),[h,b]=(0,i.useState)(""),[k,_]=(0,i.useState)(""),[C,N]=(0,i.useState)(""),[P,A]=(0,i.useState)("main"),[O,z]=(0,i.useState)("formulario"),[D,L]=(0,i.useState)([]),[E,q]=(0,i.useState)([]),[W,R]=(0,i.useState)([]),[$,B]=(0,i.useState)("");(0,i.useEffect)((()=>{I(),F(),T()}),[]);const I=()=>f(void 0,void 0,void 0,(function*(){try{const{data:e,error:r}=yield o.from("barber_services").select("*").order("created_at",{ascending:!1});if(r)throw r;t(e.map((e=>({barber:e.barber_amount,admin:e.admin_amount,tip:e.tip_amount,total:e.total_amount,barberName:e.barber_name,payment_method:e.payment_method,timestamp:new Date(e.created_at)}))))}catch(e){console.error("Error cargando servicios:",e)}})),F=()=>f(void 0,void 0,void 0,(function*(){try{const{data:e,error:t}=yield o.from("products").select("*").order("name",{ascending:!0});if(t)throw t;if(e){const t=e.map((e=>({name:e.name,quantity:e.stock,buyPrice:e.buy_price,sellPrice:e.sell_price,timestamp:new Date(e.created_at)})));L(t),R(e.map((e=>({name:e.name,sellPrice:e.sell_price}))))}}catch(e){console.error("Error cargando productos:",e)}})),T=()=>f(void 0,void 0,void 0,(function*(){try{const{data:e,error:t}=yield o.from("sales").select("*, product_id (name, buy_price, sell_price)").order("created_at",{ascending:!1});if(t)throw t;if(e){const t=e.map((e=>{var t,r,a;return{name:(null===(t=e.product_id)||void 0===t?void 0:t.name)||"",quantity:e.quantity,buyPrice:(null===(r=e.product_id)||void 0===r?void 0:r.buy_price)||0,sellPrice:(null===(a=e.product_id)||void 0===a?void 0:a.sell_price)||0,total:e.total,payment_method:e.payment_method,timestamp:new Date(e.created_at)}}));q(t)}}catch(e){console.error("Error cargando ventas:",e)}}));return(0,a.jsx)("div",{className:"container",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 24px",background:"var(--white)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:24},children:[(0,a.jsx)("img",{src:"/logo.png",alt:"Logo",style:{height:50,width:"auto"}}),(0,a.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[(0,a.jsxs)("span",{style:{color:"var(--black)",fontWeight:500},children:["Bienvenido, ",u]}),(0,a.jsx)("button",{onClick:()=>{n(null),c(null),g(""),localStorage.removeItem("barbers")},className:"btn",style:{background:"var(--black)",color:"var(--gold)"},children:"Cerrar sesión"})]})]}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:24,flexWrap:"wrap",justifyContent:"center"},children:w.filter((e=>e.roles.includes(s))).map((e=>(0,a.jsx)("button",{onClick:()=>A(e.key),className:"btn",style:{background:e.key===P?"var(--gold)":"var(--black)",color:e.key===P?"var(--black)":"var(--gold)"},children:e.label},e.key)))}),(0,a.jsxs)("div",{style:{padding:"0 24px"},children:["main"===P&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"center",marginBottom:16},children:[(0,a.jsx)("button",{onClick:()=>z("formulario"),className:"btn",style:{background:"formulario"===O?"var(--gold)":"var(--black)",color:"formulario"===O?"var(--black)":"var(--gold)"},children:"Formulario"}),"barber"!==s&&(0,a.jsx)("button",{onClick:()=>z("barberos"),className:"btn",style:{background:"barberos"===O?"var(--gold)":"var(--black)",color:"barberos"===O?"var(--black)":"var(--gold)"},children:"Barberos"})]}),"formulario"===O&&(0,a.jsx)(l,{onCalculate:e=>f(void 0,void 0,void 0,(function*(){try{const{data:r,error:a}=yield o.from("barber_services").insert([{barber_amount:e.barber,admin_amount:e.admin,tip_amount:e.tip,total_amount:e.total,barber_name:e.barberName||"",payment_method:e.payment_method||"Efectivo",created_at:e.timestamp||new Date}]);if(a)throw a;t((t=>[{barber:e.barber,admin:e.admin,tip:e.tip,total:e.total,barberName:e.barberName||"",payment_method:e.payment_method||"Efectivo",timestamp:e.timestamp||new Date},...t]))}catch(e){console.error("Error:",e),alert("Error al guardar el servicio")}}))}),"barberos"===O&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(0,a.jsx)(y,{results:e,role:s}),(0,a.jsx)("div",{className:"barberos-grid",style:{width:"100%",display:"flex",flexWrap:"wrap",justifyContent:"center",gap:32},children:"barber"===s?(()=>{const t=e.filter((e=>e.barberName===u));return(0,a.jsxs)("div",{style:{border:"1.5px solid #ccc",borderRadius:16,padding:"32px 24px",background:"#f9f9f9",textAlign:"center",boxShadow:"0 4px 16px rgba(0,0,0,0.10)",width:350,display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsx)("h3",{style:{margin:0,fontSize:22},children:u}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:16,borderRadius:8},children:[(0,a.jsx)("div",{style:{fontSize:16,color:"#666"},children:"Ganado hoy"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,color:"var(--black)"},children:["$",t.reduce(((e,t)=>e+t.barber),0).toLocaleString("es-CO")]})]}),(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:16,borderRadius:8},children:[(0,a.jsx)("div",{style:{fontSize:16,color:"#666"},children:"Propinas"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,color:"#27ae60"},children:["$",t.reduce(((e,t)=>e+(t.tip||0)),0).toLocaleString("es-CO")]})]})]})]})})():S.map((t=>{const r=e.filter((e=>e.barberName===t));return(0,a.jsxs)("div",{style:{border:"1.5px solid #ccc",borderRadius:16,padding:"32px 24px",background:"#f9f9f9",textAlign:"center",boxShadow:"0 4px 16px rgba(0,0,0,0.10)",width:350,display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsx)("h3",{style:{margin:0,fontSize:22},children:t}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:16,borderRadius:8},children:[(0,a.jsx)("div",{style:{fontSize:16,color:"#666"},children:"Ganado hoy"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,color:"var(--black)"},children:["$",r.reduce(((e,t)=>e+t.barber),0).toLocaleString("es-CO")]})]}),(0,a.jsxs)("div",{style:{background:"#f0f0f0",padding:16,borderRadius:8},children:[(0,a.jsx)("div",{style:{fontSize:16,color:"#666"},children:"Propinas"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700,color:"#27ae60"},children:["$",r.reduce(((e,t)=>e+(t.tip||0)),0).toLocaleString("es-CO")]})]})]})]},t)}))})]})]}),"inventory"===P&&(0,a.jsx)(d,{products:D,onAdd:e=>f(void 0,void 0,void 0,(function*(){try{const{data:t,error:r}=yield o.from("products").insert([{name:e.name,stock:e.quantity,buy_price:e.buyPrice,sell_price:e.sellPrice}]).select();if(r)throw r;t&&t.length>0&&(L((r=>[...r,Object.assign(Object.assign({},e),{timestamp:new Date(t[0].created_at)})])),R((t=>t.find((t=>t.name===e.name))?t:[...t,{name:e.name,sellPrice:e.sellPrice}])))}catch(e){console.error("Error:",e),alert("Error al guardar el producto")}})),onRemove:e=>f(void 0,void 0,void 0,(function*(){try{const t=D[e],{data:r,error:a}=yield o.from("products").delete().eq("name",t.name).eq("stock",t.quantity).eq("buy_price",t.buyPrice).eq("sell_price",t.sellPrice);if(a)throw a;L((t=>t.filter(((t,r)=>r!==e))))}catch(e){console.error("Error:",e),alert("Error al eliminar el producto")}})),isAdmin:"admin"===s,productList:W,onEditProductSellPrice:(e,t)=>f(void 0,void 0,void 0,(function*(){try{const{error:r}=yield o.from("products").update({sell_price:t}).eq("name",e);if(r)throw r;R((r=>r.map((r=>r.name===e?Object.assign(Object.assign({},r),{sellPrice:t}):r)))),L((r=>r.map((r=>r.name===e?Object.assign(Object.assign({},r),{sellPrice:t}):r))))}catch(e){console.error("Error:",e),alert("Error al actualizar el precio")}})),onAddProductToList:(e,t)=>{R((r=>r.find((t=>t.name===e))?r:[...r,{name:e,sellPrice:t}]))}}),"venta"===P&&(0,a.jsx)(m,{products:D,setProducts:L,sales:E,setSales:q,isAdmin:"admin"===s}),"pedidos"===P&&(0,a.jsx)(v,{productList:W,isAdmin:"admin"===s,isAux:"aux"===s}),"historial"===P&&(0,a.jsx)(p,{onDataDeleted:()=>{I(),F(),T()}}),"historial_semanal"===P&&(0,a.jsx)(x,{}),"ganancias"===P&&"barber"===s&&(0,a.jsxs)("div",{style:{maxWidth:500,margin:"0 auto",background:"var(--white)",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.06)",padding:"1.5rem 1.2rem"},children:[(0,a.jsx)("h2",{style:{textAlign:"center",marginBottom:24},children:"Mis Ganancias"}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:e.filter((e=>e.barberName===u)).map(((e,t)=>{var r;return(0,a.jsxs)("div",{style:{padding:16,background:"#f8fafc",borderRadius:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{fontSize:18,fontWeight:600,color:"var(--black)"},children:["$",e.barber.toLocaleString("es-CO")]}),(0,a.jsx)("div",{style:{fontSize:14,color:"#666"},children:null===(r=e.timestamp)||void 0===r?void 0:r.toLocaleString("es-CO",{timeZone:"America/Bogota"})})]}),e.tip>0&&(0,a.jsxs)("div",{style:{background:"#27ae60",color:"white",padding:"4px 8px",borderRadius:4,fontSize:14},children:["+$",e.tip.toLocaleString("es-CO")," propina"]})]},t)}))}),(0,a.jsxs)("div",{style:{marginTop:24,padding:16,background:"var(--gold)",borderRadius:8,textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:16,marginBottom:4},children:"Total Ganado"}),(0,a.jsxs)("div",{style:{fontSize:24,fontWeight:700},children:["$",e.filter((e=>e.barberName===u)).reduce(((e,t)=>e+t.barber),0).toLocaleString("es-CO")]})]})]}),"registros"===P&&"admin"===s&&(0,a.jsxs)("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px",background:"var(--white)",borderRadius:14,boxShadow:"0 2px 12px rgba(0,0,0,0.06)"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[(0,a.jsx)("h2",{style:{margin:0},children:"Listado de Registros"}),(0,a.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,a.jsx)("button",{onClick:()=>{let t=";",r="",a=0;S.forEach((n=>{const i=e.filter((e=>e.barberName===n)).reduce(((e,t)=>e+t.barber),0);r+=`${n.toUpperCase()}${t}${i}\n`,a+=i}));const n=E.reduce(((e,t)=>e+t.total),0);r+=`PRODUCTOS BARBERIA${t}${n}\n`,a+=n;const i=e.reduce(((e,t)=>e+t.admin),0);r+=`ADMINISTRADOR${t}${i}\n`,a+=i,r+=`TOTAL${t}${a}\n`,r+=`\nFecha de exportación${t}${(new Date).toLocaleString("es-CO",{timeZone:"America/Bogota"})}\n`;const o=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.setAttribute("download",`resumen_ganancias_invictus_${(new Date).toISOString().slice(0,10)}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},className:"btn",style:{background:"var(--gold)",color:"var(--black)"},children:"Exportar a CSV"}),(0,a.jsx)("button",{onClick:()=>f(void 0,void 0,void 0,(function*(){if(window.confirm("¿Estás seguro de que deseas borrar TODOS los registros? Esta acción no se puede deshacer."))try{const{error:e}=yield o.from("barber_services").delete().gte("id",0);if(e)throw e;t([]),alert("¡Todos los registros han sido borrados!")}catch(e){console.error("Error:",e),alert("Error al borrar los registros")}})),className:"btn",style:{background:"#e74c3c",color:"white"},children:"Borrar todos los registros"})]})]}),(0,a.jsx)("div",{style:{marginBottom:24},children:(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,a.jsx)("span",{style:{color:"var(--black)",fontWeight:500},children:"Filtrar por barbero:"}),(0,a.jsxs)("select",{value:$,onChange:e=>B(e.target.value),className:"select",style:{minWidth:200},children:[(0,a.jsx)("option",{value:"",children:"Todos"}),S.map((e=>(0,a.jsx)("option",{value:e,children:e},e)))]})]})}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12,maxHeight:"calc(100vh - 300px)",overflowY:"auto",padding:"4px"},children:e.filter((e=>!$||e.barberName===$)).map(((e,t)=>{var r;return(0,a.jsxs)("div",{style:{padding:16,background:"#f8fafc",borderRadius:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:18,fontWeight:600,color:"var(--black)",marginBottom:4},children:e.barberName}),(0,a.jsx)("div",{style:{fontSize:14,color:"#666"},children:null===(r=e.timestamp)||void 0===r?void 0:r.toLocaleString("es-CO",{timeZone:"America/Bogota"})})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:24,alignItems:"center"},children:[(0,a.jsxs)("div",{style:{textAlign:"right"},children:[(0,a.jsx)("div",{style:{fontSize:14,color:"#666",marginBottom:2},children:"Valor"}),(0,a.jsxs)("div",{style:{fontSize:16,fontWeight:500,color:"var(--black)"},children:["$",e.total.toLocaleString("es-CO")]})]}),e.tip>0&&(0,a.jsxs)("div",{style:{textAlign:"right"},children:[(0,a.jsx)("div",{style:{fontSize:14,color:"#666",marginBottom:2},children:"Propina"}),(0,a.jsxs)("div",{style:{fontSize:16,fontWeight:500,color:"#27ae60"},children:["$",e.tip.toLocaleString("es-CO")]})]}),(0,a.jsxs)("div",{style:{textAlign:"right"},children:[(0,a.jsx)("div",{style:{fontSize:14,color:"#666",marginBottom:2},children:"Método"}),(0,a.jsx)("div",{style:{fontSize:16,fontWeight:500,color:"var(--black)"},children:e.payment_method||"Efectivo"})]})]})]},t)}))})]})]})]}):(0,a.jsxs)("div",{style:{maxWidth:400,margin:"48px auto",padding:"32px 24px",background:"var(--white)",borderRadius:16,boxShadow:"0 4px 16px rgba(0,0,0,0.1)",boxSizing:"border-box"},children:[(0,a.jsx)("img",{src:"/logo.png",alt:"Logo Invictus",className:"logo",style:{marginBottom:24}}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=j.find((e=>e.user===h&&e.pass===k));t?(n(t.user),c(t.role),g(t.name),localStorage.setItem("barbers",JSON.stringify(S)),N(""),"barber"===t.role&&A("ganancias")):N("Usuario o contraseña incorrectos")},style:{width:"100%"},children:[(0,a.jsxs)("div",{style:{marginBottom:18,width:"100%"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:8,color:"var(--black)",fontWeight:600},children:"Usuario"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>b(e.target.value),className:"input",style:{width:"100%",boxSizing:"border-box"},required:!0})]}),(0,a.jsxs)("div",{style:{marginBottom:24,width:"100%"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:8,color:"var(--black)",fontWeight:600},children:"Contraseña"}),(0,a.jsx)("input",{type:"password",value:k,onChange:e=>_(e.target.value),className:"input",style:{width:"100%",boxSizing:"border-box"},required:!0})]}),C&&(0,a.jsx)("div",{style:{color:"#e74c3c",marginBottom:16,textAlign:"center"},children:C}),(0,a.jsx)("button",{type:"submit",className:"btn",style:{width:"100%",background:"var(--gold)",color:"var(--black)"},children:"Iniciar sesión"})]})]})})}),{}))},422:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(601),n=r.n(a),i=r(314),o=r.n(i)()(n());o.push([e.id,":root {\n  --gold: #FFD700;\n  --gold-dark: #e6be00;\n  --black: #000000;\n  --white: #FFFFFF;\n  --gray-bg: #f5f5f5;\n  --radius: 14px;\n  --shadow: 0 4px 24px rgba(0,0,0,0.08);\n  --font-main: 'Montserrat', Arial, sans-serif;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n  padding: 0;\n  font-family: var(--font-main);\n  background: var(--gray-bg);\n  color: var(--black);\n}\n\nh1, h2, h3, h4, h5, h6 {\n  font-weight: 700;\n  margin: 0 0 0.5em 0;\n}\n\ninput, select, button, textarea {\n  font-family: var(--font-main);\n  font-size: 1rem;\n}\n\n.container {\n  max-width: 900px;\n  margin: 2rem auto;\n  background: var(--white);\n  border-radius: var(--radius);\n  box-shadow: var(--shadow);\n  padding: 2rem 2.5rem;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 2rem;\n}\n\n.logo {\n  width: 70px;\n  height: auto;\n  border-radius: 16px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n}\n\n.btn {\n  background: var(--gold);\n  color: var(--black);\n  border: none;\n  border-radius: 8px;\n  padding: 12px 24px;\n  font-weight: 600;\n  font-size: 1rem;\n  cursor: pointer;\n  transition: background 0.2s, color 0.2s;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.06);\n}\n.btn:hover {\n  background: var(--gold-dark);\n  color: var(--white);\n}\n\n.btn-danger {\n  background: #c0392b;\n  color: var(--white);\n}\n.btn-danger:hover {\n  background: #a93226;\n}\n\n.card {\n  background: var(--white);\n  border-radius: var(--radius);\n  box-shadow: var(--shadow);\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.input, .select {\n  width: 100%;\n  padding: 10px 14px;\n  border-radius: 8px;\n  border: 1px solid #d1d5db;\n  background: #f8fafc;\n  margin-bottom: 1rem;\n  transition: border 0.2s;\n}\n.input:focus, .select:focus {\n  border: 1.5px solid var(--gold);\n  outline: none;\n}\n\n@media (max-width: 700px) {\n  .container {\n    padding: 1rem 0.5rem;\n  }\n  .header {\n    margin-bottom: 1rem;\n  }\n  .card {\n    padding: 1rem;\n  }\n  .barberos-grid {\n    grid-template-columns: 1fr;\n    gap: 24px;\n  }\n}\n\n@media (max-width: 480px) {\n  .container {\n    padding: 0.5rem 0.2rem;\n  }\n  .header {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  .logo {\n    width: 50px;\n  }\n}\n\n.barberos-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 40px;\n  margin-top: 20px;\n  justify-items: center;\n  align-items: stretch;\n}\n\n.barberos-grid > div {\n  margin: 0;\n}\n\n@media (max-width: 900px) {\n  .barberos-grid {\n    grid-template-columns: 1fr;\n  }\n} ",""]);const s=o}},e=>{e.O(0,[96],(()=>e(e.s=333))),e.O()}]);